[haskins8@lassen425:build]$ lrun -M "-gpu" -N 2 -T 1 -g 1 --gpubind=off ./ping_pong 160 1000 4 0 0
Duration  = 0.672227
Latency   = 0.000336
Bandwidth = 9139773163.058109
[haskins8@lassen425:build]$ lrun -M "-gpu" -N 2 -T 1 -g 1 --gpubind=off nvprof ./ping_pong 160 1000 4 0 0
==3391== NVPROF is profiling process 3391, command: ./ping_pong 160 1000 4 0 0
==172081== NVPROF is profiling process 172081, command: ./ping_pong 160 1000 4 0 0
Duration  = 0.648388
Latency   = 0.000324
Bandwidth = 9475812284.319046
==3391== Profiling application: ./ping_pong 160 1000 4 0 0
==172081== Profiling application: ./ping_pong 160 1000 4 0 0
==3391== Profiling result:
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   91.33%  570.89us         5  114.18us  11.228us  525.85us  void Kokkos::Impl::cuda_parallel_launch_local_memory<Kokkos::Impl::ParallelFor<Kokkos::Impl::ViewValueFunctor<Kokkos::Cuda, double, bool=1>, Kokkos::RangePolicy<>, Kokkos::Cuda>>(Kokkos::Cuda)
                    4.19%  26.176us        13  2.0130us  1.8240us  2.2720us  [CUDA memcpy DtoH]
                    2.90%  18.144us        11  1.6490us  1.4080us  1.8240us  [CUDA memcpy HtoD]
                    0.60%  3.7360us         2  1.8680us  1.7880us  1.9480us  [CUDA memset]
                    0.39%  2.4600us         1  2.4600us  2.4600us  2.4600us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_threadid(int)
                    0.36%  2.2360us         1  2.2360us  2.2360us  2.2360us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_atomic(void)
                    0.23%  1.4680us         1  1.4680us  1.4680us  1.4680us  Kokkos::Impl::_GLOBAL__N__55_tmpxft_000196bf_00000000_7_Kokkos_Cuda_Instance_cpp1_ii_a8bc5097::query_cuda_kernel_arch(int*)
      API calls:   94.06%  574.43ms         3  191.48ms  9.2650us  574.41ms  cudaDeviceSynchronize
                    2.36%  14.439ms         5  2.8879ms  13.431us  3.7476ms  cudaMallocHost
                    1.25%  7.6316ms        12  635.97us  8.7070us  3.4124ms  cudaMalloc
                    0.64%  3.9102ms         4  977.56us  890.39us  1.2201ms  cuDeviceTotalMem
                    0.42%  2.5419ms        12  211.83us  16.478us  667.48us  cudaFree
                    0.37%  2.2871ms       404  5.6610us     297ns  249.61us  cuDeviceGetAttribute
                    0.35%  2.1250ms         4  531.25us  529.73us  534.25us  cudaGetDeviceProperties
                    0.11%  659.77us        22  29.989us  24.462us  56.437us  cudaMemcpy
                    0.10%  604.65us         5  120.93us  17.913us  530.33us  cudaStreamSynchronize
                    0.06%  392.95us         1  392.95us  392.95us  392.95us  cudaHostAlloc
                    0.06%  385.81us        32  12.056us  1.3710us  340.51us  cudaEventCreateWithFlags
                    0.06%  355.88us         2  177.94us  17.222us  338.66us  cudaFreeHost
                    0.04%  220.70us       129  1.7100us  1.4750us  6.5660us  cudaEventCreate
                    0.03%  208.34us         4  52.085us  49.765us  55.283us  cuDeviceGetName
                    0.02%  130.85us         8  16.356us  12.023us  30.616us  cudaLaunchKernel
                    0.01%  74.844us       241     310ns     264ns     875ns  cudaGetLastError
                    0.01%  54.160us         2  27.080us  22.091us  32.069us  cudaMemset
                    0.01%  49.264us        33  1.4920us  1.2710us  4.7850us  cudaEventDestroy
                    0.01%  39.628us         4  9.9070us  6.2010us  14.232us  cudaStreamCreateWithFlags
                    0.01%  34.518us        32  1.0780us     988ns  2.4960us  cudaIpcGetEventHandle
                    0.01%  33.496us         2  16.748us  16.323us  17.173us  cudaMemcpyToSymbol
                    0.00%  22.694us         1  22.694us  22.694us  22.694us  cudaStreamDestroy
                    0.00%  9.7340us         5  1.9460us  1.6930us  2.5370us  cudaPointerGetAttributes
                    0.00%  8.8280us         4  2.2070us  1.2000us  3.8430us  cuDeviceGetPCIBusId
                    0.00%  6.4240us         1  6.4240us  6.4240us  6.4240us  cudaFuncGetAttributes
                    0.00%  5.5350us         1  5.5350us  5.5350us  5.5350us  cudaSetDevice
                    0.00%  3.5830us         8     447ns     349ns     678ns  cuDeviceGet
                    0.00%  2.2520us         1  2.2520us  2.2520us  2.2520us  cudaDeviceSetCacheConfig
==172081== Profiling result:
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
                    0.00%  2.0190us         1  2.0190us  2.0190us  2.0190us  cudaFuncSetCacheConfig
                    0.00%  1.6780us         2     839ns     389ns  1.2890us  cudaGetDeviceCount
                    0.00%  1.6690us         3     556ns     456ns     748ns  cuDeviceGetCount
                    0.00%  1.6150us         4     403ns     389ns     432ns  cuDeviceGetUuid
                    0.00%     621ns         1     621ns     621ns     621ns  cuCtxGetCurrent
 GPU activities:   91.34%  570.98us         5  114.20us  11.291us  525.78us  void Kokkos::Impl::cuda_parallel_launch_local_memory<Kokkos::Impl::ParallelFor<Kokkos::Impl::ViewValueFunctor<Kokkos::Cuda, double, bool=1>, Kokkos::RangePolicy<>, Kokkos::Cuda>>(Kokkos::Cuda)
                    0.00%     419ns         1     419ns     419ns     419ns  cuCtxGetDevice
                    4.15%  25.952us        13  1.9960us  1.8240us  2.2720us  [CUDA memcpy DtoH]
                    2.90%  18.112us        11  1.6460us  1.3760us  1.8240us  [CUDA memcpy HtoD]
                    0.60%  3.7680us         2  1.8840us  1.8520us  1.9160us  [CUDA memset]
                    0.40%  2.4920us         1  2.4920us  2.4920us  2.4920us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_threadid(int)
                    0.36%  2.2680us         1  2.2680us  2.2680us  2.2680us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_atomic(void)
                    0.25%  1.5320us         1  1.5320us  1.5320us  1.5320us  Kokkos::Impl::_GLOBAL__N__55_tmpxft_000196bf_00000000_7_Kokkos_Cuda_Instance_cpp1_ii_a8bc5097::query_cuda_kernel_arch(int*)
      API calls:   93.78%  557.04ms         3  185.68ms  9.1870us  557.02ms  cudaDeviceSynchronize
                    2.52%  14.987ms         5  2.9975ms  13.404us  3.9816ms  cudaMallocHost
                    1.29%  7.6616ms        12  638.47us  8.6500us  3.4240ms  cudaMalloc
                    0.64%  3.8307ms         4  957.67us  890.25us  1.1563ms  cuDeviceTotalMem
                    0.44%  2.5842ms        12  215.35us  16.660us  673.31us  cudaFree
                    0.39%  2.3203ms       404  5.7430us     293ns  253.79us  cuDeviceGetAttribute

==3391== NVTX result:
==3391==   Thread "MPI Rank 0" (id = 317616)
==3391==     Domain "<unnamed>"
==3391==       Range "MPI_Recv"
                    0.36%  2.1476ms         4  536.90us  535.00us  540.65us  cudaGetDeviceProperties
                    0.12%  685.13us        22  31.142us  23.987us  76.068us  cudaMemcpy
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  301.11ms      1000  301.11us  282.57us  12.510ms  MPI_Recv
No kernels were profiled in this range.
No API activities were profiled in this range.

==3391==       Range "MPI_Send"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
                    0.10%  606.16us         5  121.23us  18.187us  530.62us  cudaStreamSynchronize
          Range:  100.00%  345.40ms      1000  345.40us  281.79us  48.984ms  MPI_Send
No kernels were profiled in this range.
No API activities were profiled in this range.

                    0.07%  395.12us        32  12.347us  1.3770us  349.68us  cudaEventCreateWithFlags
                    0.07%  390.62us         2  195.31us  18.917us  371.71us  cudaFreeHost
                    0.07%  389.22us         1  389.22us  389.22us  389.22us  cudaHostAlloc
                    0.04%  224.83us       129  1.7420us  1.4750us  7.5230us  cudaEventCreate
                    0.04%  212.39us         4  53.097us  50.424us  58.337us  cuDeviceGetName
                    0.02%  147.63us         8  18.453us  12.633us  45.554us  cudaLaunchKernel
                    0.01%  76.247us       241     316ns     268ns  1.7330us  cudaGetLastError
                    0.01%  59.327us         2  29.663us  24.236us  35.091us  cudaMemset
                    0.01%  51.888us        33  1.5720us  1.2740us  6.5560us  cudaEventDestroy
                    0.01%  48.264us         4  12.066us  6.2010us  18.491us  cudaStreamCreateWithFlags
                    0.01%  37.040us        32  1.1570us     992ns  3.7150us  cudaIpcGetEventHandle
                    0.01%  36.211us         2  18.105us  16.864us  19.347us  cudaMemcpyToSymbol
                    0.00%  26.161us         1  26.161us  26.161us  26.161us  cudaStreamDestroy
                    0.00%  11.869us         5  2.3730us  1.7830us  4.4470us  cudaPointerGetAttributes
                    0.00%  10.000us         4  2.5000us  1.3020us  4.0240us  cuDeviceGetPCIBusId
                    0.00%  8.2570us         1  8.2570us  8.2570us  8.2570us  cudaFuncGetAttributes
                    0.00%  6.5330us         1  6.5330us  6.5330us  6.5330us  cudaSetDevice
                    0.00%  3.4650us         8     433ns     348ns     677ns  cuDeviceGet
                    0.00%  3.3480us         1  3.3480us  3.3480us  3.3480us  cudaDeviceSetCacheConfig
                    0.00%  2.5820us         1  2.5820us  2.5820us  2.5820us  cudaFuncSetCacheConfig
                    0.00%  1.7960us         4     449ns     381ns     639ns  cuDeviceGetUuid
                    0.00%  1.6430us         2     821ns     363ns  1.2800us  cudaGetDeviceCount
                    0.00%  1.6420us         3     547ns     422ns     732ns  cuDeviceGetCount
                    0.00%     641ns         1     641ns     641ns     641ns  cuCtxGetCurrent
                    0.00%     453ns         1     453ns     453ns     453ns  cuCtxGetDevice

==172081== NVTX result:
==172081==   Thread "MPI Rank 1" (id = 317616)
==172081==     Domain "<unnamed>"
==172081==       Range "MPI_Recv"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  332.05ms      1000  332.05us  281.80us  47.921ms  MPI_Recv
No kernels were profiled in this range.
No API activities were profiled in this range.

==172081==       Range "MPI_Send"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  313.40ms      1000  313.40us  282.34us  12.851ms  MPI_Send
No kernels were profiled in this range.
No API activities were profiled in this range.

[haskins8@lassen425:build]$ vim ../src/ping_pong.cpp
[haskins8@lassen425:build]$ vim ../src/main.cpp
[haskins8@lassen425:build]$ vim ../src/main.cpp
[haskins8@lassen425:build]$ lrun -M "-gpu" -N 2 -T 1 -g 1 --gpubind=off nvprof ./ping_pong 160 1000 4 1 0
==9233== NVPROF is profiling process 9233, command: ./ping_pong 160 1000 4 1 0
==177957== NVPROF is profiling process 177957, command: ./ping_pong 160 1000 4 1 0
Duration  = 0.891897
Latency   = 0.000446
Bandwidth = 6888685401.836164
==9233== Profiling application: ./ping_pong 160 1000 4 1 0
==177957== Profiling application: ./ping_pong 160 1000 4 1 0
==9233== Profiling result:
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   51.07%  75.646ms      1000  75.645us  75.035us  76.956us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ10cuda_awareiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_iEUliiiiE2_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSG_0EEEEEENS_4CudaEEEEEvT_
                   48.50%  71.836ms      1000  71.836us  71.195us  76.347us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ10cuda_awareiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_iEUliiiiE_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSG_0EEEEEENS_4CudaEEEEEvT_
                    0.39%  571.18us         5  114.24us  11.324us  525.79us  void Kokkos::Impl::cuda_parallel_launch_local_memory<Kokkos::Impl::ParallelFor<Kokkos::Impl::ViewValueFunctor<Kokkos::Cuda, double, bool=1>, Kokkos::RangePolicy<>, Kokkos::Cuda>>(Kokkos::Cuda)
                    0.02%  26.272us        13  2.0200us  1.8240us  2.3360us  [CUDA memcpy DtoH]
                    0.01%  18.111us        11  1.6460us  1.3750us  1.8240us  [CUDA memcpy HtoD]
                    0.00%  3.7680us         2  1.8840us  1.8200us  1.9480us  [CUDA memset]
                    0.00%  2.4920us         1  2.4920us  2.4920us  2.4920us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_threadid(int)
                    0.00%  2.2040us         1  2.2040us  2.2040us  2.2040us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_atomic(void)
                    0.00%  1.5000us         1  1.5000us  1.5000us  1.5000us  Kokkos::Impl::_GLOBAL__N__55_tmpxft_000196bf_00000000_7_Kokkos_Cuda_Instance_cpp1_ii_a8bc5097::query_cuda_kernel_arch(int*)
      API calls:   91.53%  641.46ms      2003  320.25us  9.0100us  482.49ms  cudaDeviceSynchronize
                    3.44%  24.137ms      2008  12.020us  11.135us  50.844us  cudaLaunchKernel
==177957== Profiling result:
                    1.98%  13.863ms         5  2.7727ms  13.316us  3.6702ms  cudaMallocHost
                    1.08%  7.5871ms        12  632.26us  8.6760us  3.4174ms  cudaMalloc
                    0.51%  3.5785ms         4  894.62us  889.79us  907.50us  cuDeviceTotalMem
                    0.37%  2.5848ms        12  215.40us  16.884us  604.52us  cudaFree
                    0.33%  2.2962ms       404  5.6830us     297ns  253.70us  cuDeviceGetAttribute
                    0.30%  2.1340ms         4  533.50us  530.32us  537.47us  cudaGetDeviceProperties
                    0.09%  648.46us        22  29.475us  23.097us  50.660us  cudaMemcpy
                    0.09%  607.91us         5  121.58us  18.302us  531.75us  cudaStreamSynchronize
                    0.06%  386.99us         1  386.99us  386.99us  386.99us  cudaHostAlloc
                    0.05%  385.02us        32  12.031us  1.3750us  339.71us  cudaEventCreateWithFlags
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
                    0.05%  354.37us         2  177.18us  17.640us  336.73us  cudaFreeHost
                    0.03%  220.75us       129  1.7110us  1.4710us  6.7340us  cudaEventCreate
                    0.03%  207.38us         4  51.846us  49.908us  56.683us  cuDeviceGetName
                    0.01%  74.648us       241     309ns     262ns  1.3340us  cudaGetLastError
 GPU activities:   50.34%  73.156ms      1000  73.156us  72.795us  73.756us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ10cuda_awareiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_iEUliiiiE2_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSG_0EEEEEENS_4CudaEEEEEvT_
                    0.01%  54.031us         2  27.015us  22.208us  31.823us  cudaMemset
                    0.01%  49.353us        33  1.4950us  1.2700us  4.9080us  cudaEventDestroy
                    0.01%  39.339us         4  9.8340us  6.0820us  14.220us  cudaStreamCreateWithFlags
                   49.23%  71.552ms      1000  71.552us  71.035us  76.443us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ10cuda_awareiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_iEUliiiiE_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSG_0EEEEEENS_4CudaEEEEEvT_
                    0.01%  35.416us        32  1.1060us     978ns  2.5960us  cudaIpcGetEventHandle
                    0.00%  33.937us         2  16.968us  16.515us  17.422us  cudaMemcpyToSymbol
                    0.00%  20.592us         1  20.592us  20.592us  20.592us  cudaStreamDestroy
                    0.39%  571.05us         5  114.21us  11.292us  525.82us  void Kokkos::Impl::cuda_parallel_launch_local_memory<Kokkos::Impl::ParallelFor<Kokkos::Impl::ViewValueFunctor<Kokkos::Cuda, double, bool=1>, Kokkos::RangePolicy<>, Kokkos::Cuda>>(Kokkos::Cuda)
                    0.00%  9.5960us         5  1.9190us  1.6810us  2.4840us  cudaPointerGetAttributes
                    0.02%  26.080us        13  2.0060us  1.8240us  2.2720us  [CUDA memcpy DtoH]
                    0.00%  9.2500us         3  3.0830us  2.1820us  4.2710us  cudaFuncSetCacheConfig
                    0.00%  8.2560us         4  2.0640us  1.3120us  3.2890us  cuDeviceGetPCIBusId
                    0.01%  18.464us        11  1.6780us  1.4080us  1.9520us  [CUDA memcpy HtoD]
                    0.00%  3.9280us         2  1.9640us  1.9160us  2.0120us  [CUDA memset]
                    0.00%  6.7480us         1  6.7480us  6.7480us  6.7480us  cudaFuncGetAttributes
                    0.00%  2.5230us         1  2.5230us  2.5230us  2.5230us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_threadid(int)
                    0.00%  2.2360us         1  2.2360us  2.2360us  2.2360us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_atomic(void)
                    0.00%  5.8550us         1  5.8550us  5.8550us  5.8550us  cudaSetDevice
                    0.00%  1.5960us         1  1.5960us  1.5960us  1.5960us  Kokkos::Impl::_GLOBAL__N__55_tmpxft_000196bf_00000000_7_Kokkos_Cuda_Instance_cpp1_ii_a8bc5097::query_cuda_kernel_arch(int*)
                    0.00%  3.6320us         8     454ns     356ns     679ns  cuDeviceGet
      API calls:   91.36%  646.01ms      2003  322.52us  9.1420us  477.45ms  cudaDeviceSynchronize
                    0.00%  2.4570us         1  2.4570us  2.4570us  2.4570us  cudaDeviceSetCacheConfig
                    3.44%  24.316ms      2008  12.109us  11.133us  69.506us  cudaLaunchKernel
                    2.13%  15.054ms         5  3.0108ms  13.942us  4.0305ms  cudaMallocHost
                    1.08%  7.6598ms        12  638.32us  8.8920us  3.4224ms  cudaMalloc
                    0.00%  1.7220us         4     430ns     379ns     529ns  cuDeviceGetUuid
                    0.00%  1.6790us         3     559ns     451ns     734ns  cuDeviceGetCount
                    0.51%  3.6072ms         4  901.80us  891.90us  923.66us  cuDeviceTotalMem
                    0.37%  2.6287ms        12  219.06us  16.949us  604.53us  cudaFree
                    0.00%  1.4080us         2     704ns     357ns  1.0510us  cudaGetDeviceCount
                    0.33%  2.3063ms       404  5.7080us     291ns  253.90us  cuDeviceGetAttribute
                    0.31%  2.1669ms         4  541.73us  538.79us  545.61us  cudaGetDeviceProperties
                    0.00%     541ns         1     541ns     541ns     541ns  cuCtxGetCurrent
                    0.09%  670.48us        22  30.476us  23.964us  63.480us  cudaMemcpy
                    0.00%     404ns         1     404ns     404ns     404ns  cuCtxGetDevice
                    0.09%  607.39us         5  121.48us  18.296us  530.49us  cudaStreamSynchronize
                    0.06%  459.05us         1  459.05us  459.05us  459.05us  cudaHostAlloc
                    0.06%  399.07us        32  12.470us  1.3870us  353.45us  cudaEventCreateWithFlags
                    0.06%  393.71us         2  196.86us  20.390us  373.32us  cudaFreeHost
                    0.03%  225.29us       129  1.7460us  1.4790us  7.7810us  cudaEventCreate
                    0.03%  212.31us         4  53.076us  50.361us  60.191us  cuDeviceGetName
                    0.01%  74.651us       241     309ns     256ns     828ns  cudaGetLastError
                    0.01%  57.420us         2  28.710us  23.068us  34.352us  cudaMemset
                    0.01%  49.944us        33  1.5130us  1.2580us  5.5160us  cudaEventDestroy
                    0.01%  45.200us         4  11.300us  5.8980us  17.089us  cudaStreamCreateWithFlags
                    0.01%  36.876us        32  1.1520us  1.0110us  3.8240us  cudaIpcGetEventHandle
                    0.01%  35.708us         2  17.854us  17.073us  18.635us  cudaMemcpyToSymbol
                    0.00%  24.192us         1  24.192us  24.192us  24.192us  cudaStreamDestroy
                    0.00%  11.793us         5  2.3580us  1.7660us  4.4380us  cudaPointerGetAttributes
                    0.00%  11.571us         3  3.8570us  2.6650us  5.6930us  cudaFuncSetCacheConfig
                    0.00%  10.260us         4  2.5650us  1.1800us  4.7480us  cuDeviceGetPCIBusId
                    0.00%  8.1810us         1  8.1810us  8.1810us  8.1810us  cudaFuncGetAttributes
                    0.00%  7.1320us         1  7.1320us  7.1320us  7.1320us  cudaSetDevice
                    0.00%  3.5880us         8     448ns     356ns     711ns  cuDeviceGet
                    0.00%  3.2950us         1  3.2950us  3.2950us  3.2950us  cudaDeviceSetCacheConfig
                    0.00%  1.7860us         4     446ns     375ns     590ns  cuDeviceGetUuid
                    0.00%  1.6400us         3     546ns     410ns     744ns  cuDeviceGetCount
                    0.00%  1.4350us         2     717ns     397ns  1.0380us  cudaGetDeviceCount
                    0.00%     652ns         1     652ns     652ns     652ns  cuCtxGetCurrent
                    0.00%     432ns         1     432ns     432ns     432ns  cuCtxGetDevice

==9233== NVTX result:
==9233==   Thread "MPI Rank 0" (id = 317616)
==9233==     Domain "<unnamed>"
==9233==       Range "MPI_Recv"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  293.33ms      1000  293.33us  288.05us  3.6381ms  MPI_Recv
No kernels were profiled in this range.
No API activities were profiled in this range.

==9233==       Range "MPI_Send"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  401.78ms      1000  401.78us  334.19us  48.690ms  MPI_Send
No kernels were profiled in this range.
No API activities were profiled in this range.


==177957== NVTX result:
==177957==   Thread "MPI Rank 1" (id = 317616)
==177957==     Domain "<unnamed>"
==177957==       Range "MPI_Recv"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  389.89ms      1000  389.89us  333.63us  50.807ms  MPI_Recv
No kernels were profiled in this range.
No API activities were profiled in this range.

==177957==       Range "MPI_Send"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  297.69ms      1000  297.69us  287.56us  4.6291ms  MPI_Send
No kernels were profiled in this range.
No API activities were profiled in this range.

[haskins8@lassen425:build]$ lrun -M "-gpu" -N 2 -T 1 -g 1 --gpubind=off nvprof ./ping_pong 160 1000 4 2 0
==10335== NVPROF is profiling process 10335, command: ./ping_pong 160 1000 4 2 0
==178886== NVPROF is profiling process 178886, command: ./ping_pong 160 1000 4 2 0
Duration  = 1.718714
Latency   = 0.000859
Bandwidth = 3574765520.036946
==178886== Profiling application: ./ping_pong 160 1000 4 2 0
==10335== Profiling application: ./ping_pong 160 1000 4 2 0
==10335== Profiling result:
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   47.68%  351.29ms      2011  174.68us  1.3760us  233.63us  [CUDA memcpy HtoD]
==178886== Profiling result:
                   32.63%  240.42ms      2013  119.43us  1.8240us  143.10us  [CUDA memcpy DtoH]
                    9.95%  73.303ms      1000  73.302us  72.763us  74.588us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ4copyiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_NS3_IS7_JS8_NS_6DeviceINS_6SerialENS_9HostSpaceEEEEEESH_SH_SH_iEUliiiiE2_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSL_0EEEEEENS_4CudaEEEEEvT_
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
                    9.66%  71.144ms      1000  71.144us  70.683us  76.187us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ4copyiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_NS3_IS7_JS8_NS_6DeviceINS_6SerialENS_9HostSpaceEEEEEESH_SH_SH_iEUliiiiE_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSL_0EEEEEENS_4CudaEEEEEvT_
 GPU activities:   47.49%  351.95ms      2011  175.01us  1.4080us  235.30us  [CUDA memcpy HtoD]
                   32.75%  242.74ms      2013  120.59us  1.8240us  141.79us  [CUDA memcpy DtoH]
                    0.08%  571.31us         5  114.26us  11.260us  526.11us  void Kokkos::Impl::cuda_parallel_launch_local_memory<Kokkos::Impl::ParallelFor<Kokkos::Impl::ViewValueFunctor<Kokkos::Cuda, double, bool=1>, Kokkos::RangePolicy<>, Kokkos::Cuda>>(Kokkos::Cuda)
                    0.00%  3.7360us         2  1.8680us  1.7880us  1.9480us  [CUDA memset]
                    0.00%  2.4920us         1  2.4920us  2.4920us  2.4920us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_threadid(int)
                    0.00%  2.2360us         1  2.2360us  2.2360us  2.2360us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_atomic(void)
                    0.00%  1.4680us         1  1.4680us  1.4680us  1.4680us  Kokkos::Impl::_GLOBAL__N__55_tmpxft_000196bf_00000000_7_Kokkos_Cuda_Instance_cpp1_ii_a8bc5097::query_cuda_kernel_arch(int*)
                    9.89%  73.326ms      1000  73.326us  72.827us  74.268us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ4copyiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_NS3_IS7_JS8_NS_6DeviceINS_6SerialENS_9HostSpaceEEEEEESH_SH_SH_iEUliiiiE2_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSL_0EEEEEENS_4CudaEEEEEvT_
      API calls:   66.16%  950.79ms      4022  236.40us  23.860us  366.38us  cudaMemcpy
                   30.47%  437.83ms      9003  48.632us  6.5640us  233.69ms  cudaDeviceSynchronize
                    2.11%  30.293ms      2008  15.085us  12.072us  32.521us  cudaLaunchKernel
                    9.78%  72.507ms      1000  72.506us  72.028us  76.955us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ4copyiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_NS3_IS7_JS8_NS_6DeviceINS_6SerialENS_9HostSpaceEEEEEESH_SH_SH_iEUliiiiE_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSL_0EEEEEENS_4CudaEEEEEvT_
                    0.41%  5.8679ms        11  533.44us  8.4450us  3.4245ms  cudaMalloc
                    0.27%  3.8521ms         4  963.01us  890.73us  1.1684ms  cuDeviceTotalMem
                    0.16%  2.2916ms       404  5.6720us     299ns  249.09us  cuDeviceGetAttribute
                    0.15%  2.1679ms        12  180.66us  2.8490us  605.21us  cudaFree
                    0.15%  2.1317ms         4  532.92us  531.09us  536.10us  cudaGetDeviceProperties
                    0.04%  604.60us         5  120.92us  18.126us  531.29us  cudaStreamSynchronize
                    0.08%  571.18us         5  114.24us  11.292us  525.75us  void Kokkos::Impl::cuda_parallel_launch_local_memory<Kokkos::Impl::ParallelFor<Kokkos::Impl::ViewValueFunctor<Kokkos::Cuda, double, bool=1>, Kokkos::RangePolicy<>, Kokkos::Cuda>>(Kokkos::Cuda)
                    0.00%  3.7360us         2  1.8680us  1.8200us  1.9160us  [CUDA memset]
                    0.03%  449.86us         1  449.86us  449.86us  449.86us  cudaHostAlloc
                    0.00%  2.5240us         1  2.5240us  2.5240us  2.5240us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_threadid(int)
                    0.02%  355.40us         2  177.70us  18.353us  337.05us  cudaFreeHost
                    0.00%  2.3000us         1  2.3000us  2.3000us  2.3000us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_atomic(void)
                    0.00%  1.7240us         1  1.7240us  1.7240us  1.7240us  Kokkos::Impl::_GLOBAL__N__55_tmpxft_000196bf_00000000_7_Kokkos_Cuda_Instance_cpp1_ii_a8bc5097::query_cuda_kernel_arch(int*)
                    0.01%  211.23us         4  52.808us  50.164us  59.849us  cuDeviceGetName
                    0.00%  52.643us         2  26.321us  22.632us  30.011us  cudaMemset
                    0.00%  34.203us         2  17.101us  16.942us  17.261us  cudaMemcpyToSymbol
                    0.00%  13.267us         1  13.267us  13.267us  13.267us  cudaMallocHost
                    0.00%  9.8650us         5  1.9730us  1.7110us  2.7710us  cudaPointerGetAttributes
                    0.00%  8.3270us         4  2.0810us  1.2810us  3.4550us  cuDeviceGetPCIBusId
      API calls:   65.86%  957.95ms      4022  238.18us  23.713us  366.51us  cudaMemcpy
                    0.00%  7.2920us         3  2.4300us  2.2440us  2.7740us  cudaFuncSetCacheConfig
                    0.00%  6.8510us         1  6.8510us  6.8510us  6.8510us  cudaFuncGetAttributes
                   30.83%  448.46ms      9003  49.812us  6.6110us  230.14ms  cudaDeviceSynchronize
                    0.00%  5.3100us         1  5.3100us  5.3100us  5.3100us  cudaSetDevice
                    0.00%  3.7270us         1  3.7270us  3.7270us  3.7270us  cudaEventDestroy
                    2.07%  30.085ms      2008  14.982us  12.124us  45.680us  cudaLaunchKernel
                    0.40%  5.8906ms        11  535.51us  8.8960us  3.4339ms  cudaMalloc
                    0.00%  3.6400us         8     455ns     369ns     704ns  cuDeviceGet
                    0.00%  3.1190us         1  3.1190us  3.1190us  3.1190us  cudaEventCreate
                    0.25%  3.5810ms         4  895.24us  889.20us  908.95us  cuDeviceTotalMem
                    0.00%  2.2420us         1  2.2420us  2.2420us  2.2420us  cudaDeviceSetCacheConfig
                    0.16%  2.3013ms       404  5.6960us     293ns  253.05us  cuDeviceGetAttribute
                    0.00%  1.7460us         4     436ns     397ns     535ns  cuDeviceGetUuid
                    0.00%  1.6660us         3     555ns     457ns     717ns  cuDeviceGetCount
                    0.15%  2.2205ms        12  185.04us  2.9810us  606.77us  cudaFree
                    0.15%  2.1466ms         4  536.66us  534.25us  538.79us  cudaGetDeviceProperties
                    0.00%  1.3450us         1  1.3450us  1.3450us  1.3450us  cudaGetLastError
                    0.04%  608.63us         5  121.73us  18.982us  530.88us  cudaStreamSynchronize
                    0.03%  457.27us         1  457.27us  457.27us  457.27us  cudaHostAlloc
                    0.00%     948ns         1     948ns     948ns     948ns  cudaGetDeviceCount
                    0.03%  396.88us         2  198.44us  19.163us  377.72us  cudaFreeHost
                    0.01%  209.47us         4  52.367us  49.888us  57.758us  cuDeviceGetName
                    0.00%  59.037us         2  29.518us  24.054us  34.983us  cudaMemset
                    0.00%  35.217us         2  17.608us  16.831us  18.386us  cudaMemcpyToSymbol
                    0.00%  13.451us         1  13.451us  13.451us  13.451us  cudaMallocHost
                    0.00%  11.533us         5  2.3060us  1.7760us  4.0620us  cudaPointerGetAttributes
                    0.00%  10.184us         4  2.5460us  1.3280us  4.2700us  cuDeviceGetPCIBusId
                    0.00%  7.7590us         1  7.7590us  7.7590us  7.7590us  cudaFuncGetAttributes
                    0.00%  7.6430us         3  2.5470us  2.2130us  2.7620us  cudaFuncSetCacheConfig
                    0.00%  6.9840us         1  6.9840us  6.9840us  6.9840us  cudaSetDevice
                    0.00%  5.1600us         1  5.1600us  5.1600us  5.1600us  cudaEventDestroy
                    0.00%  4.1080us         1  4.1080us  4.1080us  4.1080us  cudaEventCreate
                    0.00%  3.6350us         8     454ns     351ns     834ns  cuDeviceGet
                    0.00%  3.2620us         1  3.2620us  3.2620us  3.2620us  cudaDeviceSetCacheConfig
                    0.00%  1.8020us         4     450ns     380ns     615ns  cuDeviceGetUuid
                    0.00%  1.5720us         3     524ns     434ns     672ns  cuDeviceGetCount
                    0.00%  1.5530us         1  1.5530us  1.5530us  1.5530us  cudaGetLastError
                    0.00%  1.1700us         1  1.1700us  1.1700us  1.1700us  cudaGetDeviceCount

==10335== NVTX result:
==10335==   Thread "MPI Rank 0" (id = 317616)
==10335==     Domain "<unnamed>"
==10335==       Range "MPI_Recv"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  236.56ms      1000  236.56us  232.44us  539.69us  MPI_Recv
No kernels were profiled in this range.
No API activities were profiled in this range.

==10335==       Range "MPI_Send"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  271.07ms      1000  271.07us  244.48us  17.231ms  MPI_Send
No kernels were profiled in this range.
No API activities were profiled in this range.


==178886== NVTX result:
==178886==   Thread "MPI Rank 1" (id = 317616)
==178886==     Domain "<unnamed>"
==178886==       Range "MPI_Recv"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  243.64ms      1000  243.64us  241.11us  885.83us  MPI_Recv
No kernels were profiled in this range.
No API activities were profiled in this range.

==178886==       Range "MPI_Send"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  241.62ms      1000  241.62us  234.19us  4.3485ms  MPI_Send
No kernels were profiled in this range.
No API activities were profiled in this range.

# y direction
# direct

skins8@lassen277:build]$ lrun -M "-gpu" -N 2 -T 1 -g 1 --gpubind=off nvprof ./ping_pong 160 1000 4 0 1
==135757== NVPROF is profiling process 135757, command: ./ping_pong 160 1000 4 0 1
==77979== NVPROF is profiling process 77979, command: ./ping_pong 160 1000 4 0 1
Duration  = 19.977674
Latency   = 0.009989
Bandwidth = 307543310.766958
==135757== Profiling application: ./ping_pong 160 1000 4 0 1
==77979== Profiling application: ./ping_pong 160 1000 4 0 1
==77979== Profiling result:
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   58.73%  559.32ms    160011  3.4950us  1.3760us  4.5440us  [CUDA memcpy HtoD]
                   41.21%  392.44ms    160013  2.4520us  1.8240us  3.7120us  [CUDA memcpy DtoH]
                    0.06%  570.79us         5  114.16us  11.292us  525.63us  void Kokkos::Impl::cuda_parallel_launch_local_memory<Kokkos::Impl::ParallelFor<Kokkos::Impl::ViewValueFunctor<Kokkos::Cuda, double, bool=1>, Kokkos::RangePolicy<>, Kokkos::Cuda>>(Kokkos::Cuda)
                    0.00%  3.6400us         2  1.8200us  1.8200us  1.8200us  [CUDA memset]
                    0.00%  2.5560us         1  2.5560us  2.5560us  2.5560us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_threadid(int)
                    0.00%  2.2360us         1  2.2360us  2.2360us  2.2360us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_atomic(void)
                    0.00%  1.5320us         1  1.5320us  1.5320us  1.5320us  Kokkos::Impl::_GLOBAL__N__55_tmpxft_000196bf_00000000_7_Kokkos_Cuda_Instance_cpp1_ii_a8bc5097::query_cuda_kernel_arch(int*)
      API calls:   84.66%  8.25765s    320022  25.803us  23.870us  47.804ms  cudaMemcpy
                   15.15%  1.47820s    160003  9.2380us  6.8110us  317.65ms  cudaDeviceSynchronize
                    0.06%  6.0113ms        11  546.48us  8.5580us  3.4206ms  cudaMalloc
                    0.04%  3.5909ms         4  897.72us  891.97us  914.32us  cuDeviceTotalMem
                    0.02%  2.2925ms       404  5.6740us     292ns  248.36us  cuDeviceGetAttribute
                    0.02%  2.2178ms        12  184.82us  2.8390us  607.35us  cudaFree
                    0.02%  2.1417ms         4  535.43us  534.13us  538.69us  cudaGetDeviceProperties
                    0.01%  602.96us         5  120.59us  18.074us  530.08us  cudaStreamSynchronize
                    0.00%  450.53us         1  450.53us  450.53us  450.53us  cudaHostAlloc
                    0.00%  407.15us         2  203.58us  18.884us  388.27us  cudaFreeHost
                    0.00%  207.81us         4  51.953us  50.060us  57.000us  cuDeviceGetName
                    0.00%  132.66us         8  16.582us  12.127us  31.295us  cudaLaunchKernel
                    0.00%  53.250us         2  26.625us  22.472us  30.778us  cudaMemset
                    0.00%  34.307us         2  17.153us  16.927us  17.380us  cudaMemcpyToSymbol
                    0.00%  13.419us         1  13.419us  13.419us  13.419us  cudaMallocHost
                    0.00%  10.011us         5  2.0020us  1.7570us  2.6990us  cudaPointerGetAttributes
                    0.00%  8.9010us         4  2.2250us  1.2110us  3.7260us  cuDeviceGetPCIBusId
                    0.00%  6.7130us         1  6.7130us  6.7130us  6.7130us  cudaFuncGetAttributes
                    0.00%  5.7720us         1  5.7720us  5.7720us  5.7720us  cudaSetDevice
                    0.00%  3.6190us         8     452ns     363ns     685ns  cuDeviceGet
                    0.00%  3.5020us         1  3.5020us  3.5020us  3.5020us  cudaEventDestroy
                    0.00%  3.0640us         1  3.0640us  3.0640us  3.0640us  cudaEventCreate
                    0.00%  2.0980us         1  2.0980us  2.0980us  2.0980us  cudaDeviceSetCacheConfig
                    0.00%  2.0610us         1  2.0610us  2.0610us  2.0610us  cudaFuncSetCacheConfig
                    0.00%  1.7370us         4     434ns     390ns     500ns  cuDeviceGetUuid
                    0.00%  1.6830us         3     561ns     440ns     749ns  cuDeviceGetCount
                    0.00%  1.6820us         1  1.6820us  1.6820us  1.6820us  cudaGetLastError
                    0.00%  1.1270us         1  1.1270us  1.1270us  1.1270us  cudaGetDeviceCount
==135757== Profiling result:
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   58.82%  558.96ms    160011  3.4930us  1.3760us  4.3200us  [CUDA memcpy HtoD]
                   41.12%  390.78ms    160013  2.4420us  1.8240us  4.4160us  [CUDA memcpy DtoH]
                    0.06%  570.57us         5  114.11us  11.260us  525.31us  void Kokkos::Impl::cuda_parallel_launch_local_memory<Kokkos::Impl::ParallelFor<Kokkos::Impl::ViewValueFunctor<Kokkos::Cuda, double, bool=1>, Kokkos::RangePolicy<>, Kokkos::Cuda>>(Kokkos::Cuda)
                    0.00%  3.7680us         2  1.8840us  1.7880us  1.9800us  [CUDA memset]
                    0.00%  2.5240us         1  2.5240us  2.5240us  2.5240us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_threadid(int)
                    0.00%  2.2360us         1  2.2360us  2.2360us  2.2360us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_atomic(void)
                    0.00%  1.4680us         1  1.4680us  1.4680us  1.4680us  Kokkos::Impl::_GLOBAL__N__55_tmpxft_000196bf_00000000_7_Kokkos_Cuda_Instance_cpp1_ii_a8bc5097::query_cuda_kernel_arch(int*)
      API calls:   84.81%  8.42425s    320022  26.323us  23.273us  48.034ms  cudaMemcpy
                   15.01%  1.49053s    160003  9.3150us  6.7750us  345.75ms  cudaDeviceSynchronize
                    0.06%  6.2269ms        11  566.08us  8.6030us  3.7885ms  cudaMalloc
                    0.04%  3.5756ms         4  893.90us  889.45us  905.54us  cuDeviceTotalMem
                    0.02%  2.3040ms       404  5.7020us     295ns  251.13us  cuDeviceGetAttribute
                    0.02%  2.2752ms        12  189.60us  2.9850us  605.48us  cudaFree
                    0.02%  2.1694ms         4  542.35us  534.42us  559.23us  cudaGetDeviceProperties
                    0.01%  605.53us         5  121.11us  18.119us  530.67us  cudaStreamSynchronize
                    0.00%  418.74us         1  418.74us  418.74us  418.74us  cudaHostAlloc
                    0.00%  399.62us         2  199.81us  18.829us  380.79us  cudaFreeHost
                    0.00%  208.00us         4  51.999us  50.041us  56.623us  cuDeviceGetName
                    0.00%  133.15us         8  16.644us  12.478us  30.583us  cudaLaunchKernel
                    0.00%  52.762us         2  26.381us  22.599us  30.163us  cudaMemset
                    0.00%  34.659us         2  17.329us  17.275us  17.384us  cudaMemcpyToSymbol
                    0.00%  12.788us         1  12.788us  12.788us  12.788us  cudaMallocHost
                    0.00%  10.043us         5  2.0080us  1.7640us  2.6560us  cudaPointerGetAttributes
                    0.00%  8.7280us         4  2.1820us  1.3360us  3.6130us  cuDeviceGetPCIBusId
                    0.00%  6.7580us         1  6.7580us  6.7580us  6.7580us  cudaFuncGetAttributes
                    0.00%  5.7710us         1  5.7710us  5.7710us  5.7710us  cudaSetDevice
                    0.00%  3.6970us         1  3.6970us  3.6970us  3.6970us  cudaEventDestroy
                    0.00%  3.6520us         8     456ns     353ns     785ns  cuDeviceGet
                    0.00%  3.0270us         1  3.0270us  3.0270us  3.0270us  cudaEventCreate
                    0.00%  2.3100us         1  2.3100us  2.3100us  2.3100us  cudaDeviceSetCacheConfig
                    0.00%  2.0060us         1  2.0060us  2.0060us  2.0060us  cudaFuncSetCacheConfig
                    0.00%  1.6990us         4     424ns     403ns     483ns  cuDeviceGetUuid
                    0.00%  1.6190us         3     539ns     426ns     701ns  cuDeviceGetCount
                    0.00%  1.3180us         1  1.3180us  1.3180us  1.3180us  cudaGetLastError
                    0.00%  1.1490us         1  1.1490us  1.1490us  1.1490us  cudaGetDeviceCount

==77979== NVTX result:
==77979==   Thread "MPI Rank 0" (id = 317616)
==77979==     Domain "<unnamed>"
==77979==       Range "MPI_Recv"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  15.4549s      1000  15.455ms  15.066ms  117.40ms  MPI_Recv
 GPU activities:  100.00%  559.30ms    160000  3.4950us  3.4240us  4.5440us  [CUDA memcpy HtoD]
      API calls:  100.00%  4.09444s    160000  25.590us  24.191us  47.804ms  cudaMemcpy

==77979==       Range "MPI_Send"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  4.51998s      1000  4.5200ms  4.4338ms  11.200ms  MPI_Send
 GPU activities:  100.00%  392.41ms    160000  2.4520us  2.2710us  3.7120us  [CUDA memcpy DtoH]
      API calls:  100.00%  4.16258s    160000  26.016us  24.017us  2.8704ms  cudaMemcpy


==135757== NVTX result:
==135757==   Thread "MPI Rank 1" (id = 317616)
==135757==     Domain "<unnamed>"
==135757==       Range "MPI_Recv"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  15.3272s      1000  15.327ms  10.614ms  63.330ms  MPI_Recv
 GPU activities:  100.00%  558.94ms    160000  3.4930us  3.4550us  4.3200us  [CUDA memcpy HtoD]
      API calls:  100.00%  4.13293s    160000  25.830us  24.702us  6.3570ms  cudaMemcpy

==135757==       Range "MPI_Send"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  4.64095s      1000  4.6410ms  4.4987ms  52.892ms  MPI_Send
 GPU activities:  100.00%  390.75ms    160000  2.4420us  2.2710us  4.4160us  [CUDA memcpy DtoH]
      API calls:  100.00%  4.29068s    160000  26.816us  24.556us  48.034ms  cudaMemcpy

# y direction
# cuda aware

[haskins8@lassen277:build]$ lrun -M "-gpu" -N 2 -T 1 -g 1 --gpubind=off nvprof ./ping_pong 160 1000 4 1 1
==142923== NVPROF is profiling process 142923, command: ./ping_pong 160 1000 4 1 1
==85327== NVPROF is profiling process 85327, command: ./ping_pong 160 1000 4 1 1
Duration  = 0.892673
Latency   = 0.000446
Bandwidth = 6882701076.246758
==85327== Profiling application: ./ping_pong 160 1000 4 1 1
==142923== Profiling application: ./ping_pong 160 1000 4 1 1
==85327== Profiling result:
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   50.85%  64.754ms      1000  64.754us  64.220us  69.660us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ10cuda_awareiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_iEUliiiiE0_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSG_0EEEEEENS_4CudaEEEEEvT_
                   48.66%  61.974ms      1000  61.974us  61.563us  63.228us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ10cuda_awareiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_iEUliiiiE3_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSG_0EEEEEENS_4CudaEEEEEvT_
                    0.45%  571.05us         5  114.21us  11.292us  525.88us  void Kokkos::Impl::cuda_parallel_launch_local_memory<Kokkos::Impl::ParallelFor<Kokkos::Impl::ViewValueFunctor<Kokkos::Cuda, double, bool=1>, Kokkos::RangePolicy<>, Kokkos::Cuda>>(Kokkos::Cuda)
                    0.02%  26.112us        13  2.0080us  1.8240us  2.2720us  [CUDA memcpy DtoH]
                    0.01%  18.048us        11  1.6400us  1.4080us  1.8240us  [CUDA memcpy HtoD]
                    0.00%  3.6080us         2  1.8040us  1.7880us  1.8200us  [CUDA memset]
                    0.00%  2.5240us         1  2.5240us  2.5240us  2.5240us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_threadid(int)
                    0.00%  2.2040us         1  2.2040us  2.2040us  2.2040us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_atomic(void)
                    0.00%  1.5320us         1  1.5320us  1.5320us  1.5320us  Kokkos::Impl::_GLOBAL__N__55_tmpxft_000196bf_00000000_7_Kokkos_Cuda_Instance_cpp1_ii_a8bc5097::query_cuda_kernel_arch(int*)
      API calls:   86.60%  397.67ms      2003  198.54us  9.2500us  247.14ms  cudaDeviceSynchronize
                    5.30%  24.345ms      2008  12.124us  11.256us  40.587us  cudaLaunchKernel
                    3.16%  14.512ms         5  2.9025ms  13.427us  3.6929ms  cudaMallocHost
                    1.66%  7.6156ms        12  634.63us  8.7020us  3.4235ms  cudaMalloc
                    0.78%  3.5841ms         4  896.01us  891.70us  907.28us  cuDeviceTotalMem
                    0.69%  3.1852ms       404  7.8840us     299ns  1.1067ms  cuDeviceGetAttribute
                    0.57%  2.6033ms        12  216.94us  16.521us  610.06us  cudaFree
                    0.53%  2.4279ms         4  606.96us  535.95us  814.28us  cudaGetDeviceProperties
                    0.14%  649.67us        22  29.530us  23.595us  51.525us  cudaMemcpy
==142923== Profiling result:
                    0.13%  606.42us         5  121.28us  18.265us  530.23us  cudaStreamSynchronize
                    0.09%  415.94us         1  415.94us  415.94us  415.94us  cudaHostAlloc
                    0.09%  396.99us         2  198.49us  18.054us  378.94us  cudaFreeHost
                    0.09%  394.94us        32  12.341us  1.3840us  349.44us  cudaEventCreateWithFlags
                    0.05%  221.38us       129  1.7160us  1.4630us  7.1050us  cudaEventCreate
                    0.05%  211.13us         4  52.783us  49.840us  59.298us  cuDeviceGetName
                    0.02%  75.963us       241     315ns     252ns  1.2810us  cudaGetLastError
                    0.01%  51.980us         2  25.990us  22.003us  29.977us  cudaMemset
                    0.01%  50.428us        33  1.5280us  1.3010us  5.0020us  cudaEventDestroy
                    0.01%  39.568us         4  9.8920us  6.0210us  14.531us  cudaStreamCreateWithFlags
                    0.01%  35.588us        32  1.1120us     990ns  2.7320us  cudaIpcGetEventHandle
                    0.01%  33.591us         2  16.795us  16.344us  17.247us  cudaMemcpyToSymbol
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
                    0.00%  20.653us         1  20.653us  20.653us  20.653us  cudaStreamDestroy
                    0.00%  10.283us         5  2.0560us  1.7930us  2.7260us  cudaPointerGetAttributes
                    0.00%  8.6520us         4  2.1630us  1.2300us  3.3990us  cuDeviceGetPCIBusId
                    0.00%  8.3730us         3  2.7910us  2.0370us  3.6510us  cudaFuncSetCacheConfig
 GPU activities:   50.88%  64.686ms      1000  64.685us  64.220us  69.500us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ10cuda_awareiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_iEUliiiiE0_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSG_0EEEEEENS_4CudaEEEEEvT_
                    0.00%  6.8080us         1  6.8080us  6.8080us  6.8080us  cudaFuncGetAttributes
                    0.00%  6.2510us         1  6.2510us  6.2510us  6.2510us  cudaSetDevice
                    0.00%  3.5420us         8     442ns     345ns     738ns  cuDeviceGet
                    0.00%  2.5200us         1  2.5200us  2.5200us  2.5200us  cudaDeviceSetCacheConfig
                   48.63%  61.828ms      1000  61.827us  61.308us  63.356us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ10cuda_awareiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_iEUliiiiE3_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSG_0EEEEEENS_4CudaEEEEEvT_
                    0.00%  1.6800us         4     420ns     391ns     441ns  cuDeviceGetUuid
                    0.00%  1.6160us         3     538ns     438ns     695ns  cuDeviceGetCount
                    0.00%  1.6090us         2     804ns     340ns  1.2690us  cudaGetDeviceCount
                    0.00%     597ns         1     597ns     597ns     597ns  cuCtxGetCurrent
                    0.45%  570.60us         5  114.12us  11.292us  525.37us  void Kokkos::Impl::cuda_parallel_launch_local_memory<Kokkos::Impl::ParallelFor<Kokkos::Impl::ViewValueFunctor<Kokkos::Cuda, double, bool=1>, Kokkos::RangePolicy<>, Kokkos::Cuda>>(Kokkos::Cuda)
                    0.00%     445ns         1     445ns     445ns     445ns  cuCtxGetDevice
                    0.02%  26.080us        13  2.0060us  1.7920us  2.2720us  [CUDA memcpy DtoH]
                    0.01%  18.208us        11  1.6550us  1.4080us  1.8880us  [CUDA memcpy HtoD]
                    0.00%  3.7040us         2  1.8520us  1.7560us  1.9480us  [CUDA memset]
                    0.00%  2.5240us         1  2.5240us  2.5240us  2.5240us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_threadid(int)
                    0.00%  2.2040us         1  2.2040us  2.2040us  2.2040us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_atomic(void)
                    0.00%  1.6280us         1  1.6280us  1.6280us  1.6280us  Kokkos::Impl::_GLOBAL__N__55_tmpxft_000196bf_00000000_7_Kokkos_Cuda_Instance_cpp1_ii_a8bc5097::query_cuda_kernel_arch(int*)
      API calls:   88.23%  452.43ms      2003  225.87us  9.0020us  314.67ms  cudaDeviceSynchronize
                    4.70%  24.102ms      2008  12.002us  11.134us  52.631us  cudaLaunchKernel
                    2.85%  14.622ms         5  2.9245ms  13.406us  3.7793ms  cudaMallocHost
                    1.48%  7.6142ms        12  634.52us  8.9980us  3.4442ms  cudaMalloc
                    0.70%  3.6028ms         4  900.70us  892.02us  910.76us  cuDeviceTotalMem
                    0.51%  2.6311ms        12  219.26us  16.835us  608.39us  cudaFree
                    0.45%  2.3150ms       404  5.7300us     293ns  250.87us  cuDeviceGetAttribute
                    0.43%  2.1911ms         4  547.77us  542.87us  556.04us  cudaGetDeviceProperties
                    0.13%  642.43us        22  29.201us  23.433us  50.340us  cudaMemcpy
                    0.12%  607.40us         5  121.48us  18.308us  530.11us  cudaStreamSynchronize
                    0.08%  431.70us         1  431.70us  431.70us  431.70us  cudaHostAlloc
                    0.08%  393.92us        32  12.309us  1.3900us  348.60us  cudaEventCreateWithFlags
                    0.08%  391.68us         2  195.84us  18.204us  373.48us  cudaFreeHost
                    0.04%  220.64us       129  1.7100us  1.4510us  6.7540us  cudaEventCreate
                    0.04%  209.79us         4  52.448us  50.623us  56.981us  cuDeviceGetName
                    0.01%  74.851us       241     310ns     260ns     933ns  cudaGetLastError
                    0.01%  53.096us         2  26.548us  22.060us  31.036us  cudaMemset
                    0.01%  48.109us        33  1.4570us  1.2480us  4.8710us  cudaEventDestroy
                    0.01%  39.845us         4  9.9610us  6.0350us  15.101us  cudaStreamCreateWithFlags
                    0.01%  35.872us        32  1.1210us  1.0000us  2.8530us  cudaIpcGetEventHandle
                    0.01%  33.260us         2  16.630us  16.302us  16.958us  cudaMemcpyToSymbol
                    0.00%  21.122us         1  21.122us  21.122us  21.122us  cudaStreamDestroy
                    0.00%  10.127us         5  2.0250us  1.7790us  2.6970us  cudaPointerGetAttributes
                    0.00%  9.0710us         3  3.0230us  2.4160us  3.9810us  cudaFuncSetCacheConfig
                    0.00%  8.9410us         4  2.2350us  1.3940us  3.9220us  cuDeviceGetPCIBusId
                    0.00%  6.8670us         1  6.8670us  6.8670us  6.8670us  cudaFuncGetAttributes
                    0.00%  6.1040us         1  6.1040us  6.1040us  6.1040us  cudaSetDevice
                    0.00%  3.6340us         8     454ns     365ns     725ns  cuDeviceGet
                    0.00%  2.1510us         1  2.1510us  2.1510us  2.1510us  cudaDeviceSetCacheConfig
                    0.00%  1.6980us         4     424ns     381ns     506ns  cuDeviceGetUuid
                    0.00%  1.6610us         3     553ns     465ns     717ns  cuDeviceGetCount
                    0.00%  1.4010us         2     700ns     344ns  1.0570us  cudaGetDeviceCount
                    0.00%     707ns         1     707ns     707ns     707ns  cuCtxGetCurrent
                    0.00%     465ns         1     465ns     465ns     465ns  cuCtxGetDevice

==85327== NVTX result:
==85327==   Thread "MPI Rank 0" (id = 317616)
==85327==     Domain "<unnamed>"
==85327==       Range "MPI_Recv"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  299.72ms      1000  299.72us  291.45us  3.7219ms  MPI_Recv
No kernels were profiled in this range.
No API activities were profiled in this range.

==85327==       Range "MPI_Send"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  404.42ms      1000  404.42us  337.37us  49.130ms  MPI_Send
No kernels were profiled in this range.
No API activities were profiled in this range.


==142923== NVTX result:
==142923==   Thread "MPI Rank 1" (id = 317616)
==142923==     Domain "<unnamed>"
==142923==       Range "MPI_Recv"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  419.34ms      1000  419.34us  336.20us  49.743ms  MPI_Recv
No kernels were profiled in this range.
No API activities were profiled in this range.

==142923==       Range "MPI_Send"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  298.37ms      1000  298.37us  290.77us  3.7266ms  MPI_Send
No kernels were profiled in this range.
No API activities were profiled in this range.

# y direction
# copy

[haskins8@lassen277:build]$ lrun -M "-gpu" -N 2 -T 1 -g 1 --gpubind=off nvprof ./ping_pong 160 1000 4 2 1
==143485== NVPROF is profiling process 143485, command: ./ping_pong 160 1000 4 2 1
==85856== NVPROF is profiling process 85856, command: ./ping_pong 160 1000 4 2 1
Duration  = 1.710145
Latency   = 0.000855
Bandwidth = 3592678836.960956
==143485== Profiling application: ./ping_pong 160 1000 4 2 1
==85856== Profiling application: ./ping_pong 160 1000 4 2 1
==143485== Profiling result:
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   48.83%  352.31ms      2011  175.19us  1.4080us  237.18us  [CUDA memcpy HtoD]
                   33.28%  240.11ms      2013  119.28us  1.8240us  142.72us  [CUDA memcpy DtoH]
                    9.27%  66.918ms      1000  66.917us  66.523us  72.348us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ4copyiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_NS3_IS7_JS8_NS_6DeviceINS_6SerialENS_9HostSpaceEEEEEESH_SH_SH_iEUliiiiE0_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSL_0EEEEEENS_4CudaEEEEEvT_
                    8.54%  61.622ms      1000  61.622us  61.147us  62.684us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ4copyiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_NS3_IS7_JS8_NS_6DeviceINS_6SerialENS_9HostSpaceEEEEEESH_SH_SH_iEUliiiiE3_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSL_0EEEEEENS_4CudaEEEEEvT_
                    0.08%  570.28us         5  114.06us  11.260us  525.24us  void Kokkos::Impl::cuda_parallel_launch_local_memory<Kokkos::Impl::ParallelFor<Kokkos::Impl::ViewValueFunctor<Kokkos::Cuda, double, bool=1>, Kokkos::RangePolicy<>, Kokkos::Cuda>>(Kokkos::Cuda)
                    0.00%  3.7360us         2  1.8680us  1.7880us  1.9480us  [CUDA memset]
                    0.00%  2.4920us         1  2.4920us  2.4920us  2.4920us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_threadid(int)
                    0.00%  2.2360us         1  2.2360us  2.2360us  2.2360us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_atomic(void)
                    0.00%  1.4680us         1  1.4680us  1.4680us  1.4680us  Kokkos::Impl::_GLOBAL__N__55_tmpxft_000196bf_00000000_7_Kokkos_Cuda_Instance_cpp1_ii_a8bc5097::query_cuda_kernel_arch(int*)
      API calls:   57.81%  953.92ms      4022  237.18us  23.706us  392.45us  cudaMemcpy
                   39.28%  648.10ms      9003  71.986us  6.6130us  459.20ms  cudaDeviceSynchronize
                    1.80%  29.726ms      2008  14.803us  12.150us  32.323us  cudaLaunchKernel
                    0.36%  5.8822ms        11  534.74us  8.9920us  3.4229ms  cudaMalloc
                    0.22%  3.5858ms         4  896.44us  891.17us  907.75us  cuDeviceTotalMem
                    0.15%  2.4736ms        12  206.14us  2.9920us  603.64us  cudaFree
                    0.15%  2.4444ms       404  6.0500us     295ns  380.28us  cuDeviceGetAttribute
                    0.13%  2.1457ms         4  536.44us  534.09us  540.02us  cudaGetDeviceProperties
                    0.04%  604.17us         5  120.83us  18.243us  530.13us  cudaStreamSynchronize
                    0.03%  421.31us         1  421.31us  421.31us  421.31us  cudaHostAlloc
                    0.02%  396.98us         2  198.49us  20.841us  376.14us  cudaFreeHost
                    0.01%  207.71us         4  51.928us  50.164us  55.607us  cuDeviceGetName
                    0.00%  56.432us         2  28.216us  24.073us  32.359us  cudaMemset
                    0.00%  34.082us         2  17.041us  16.556us  17.526us  cudaMemcpyToSymbol
                    0.00%  13.667us         1  13.667us  13.667us  13.667us  cudaMallocHost
                    0.00%  10.042us         5  2.0080us  1.8140us  2.5270us  cudaPointerGetAttributes
                    0.00%  9.0530us         4  2.2630us  1.2310us  3.9840us  cuDeviceGetPCIBusId
                    0.00%  7.0460us         1  7.0460us  7.0460us  7.0460us  cudaFuncGetAttributes
                    0.00%  7.0080us         3  2.3360us  2.1870us  2.6160us  cudaFuncSetCacheConfig
==85856== Profiling result:
                    0.00%  6.2070us         1  6.2070us  6.2070us  6.2070us  cudaSetDevice
                    0.00%  3.6640us         8     458ns     307ns     904ns  cuDeviceGet
                    0.00%  3.4420us         1  3.4420us  3.4420us  3.4420us  cudaEventDestroy
                    0.00%  3.4020us         1  3.4020us  3.4020us  3.4020us  cudaEventCreate
                    0.00%  2.4490us         1  2.4490us  2.4490us  2.4490us  cudaDeviceSetCacheConfig
                    0.00%  1.7130us         4     428ns     385ns     488ns  cuDeviceGetUuid
                    0.00%  1.5740us         3     524ns     418ns     668ns  cuDeviceGetCount
                    0.00%  1.1790us         1  1.1790us  1.1790us  1.1790us  cudaGetDeviceCount
                    0.00%  1.1480us         1  1.1480us  1.1480us  1.1480us  cudaGetLastError
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   49.67%  360.81ms      2011  179.42us  1.4080us  12.971ms  [CUDA memcpy HtoD]
                   32.50%  236.14ms      2013  117.31us  1.8240us  169.60us  [CUDA memcpy DtoH]
                    9.20%  66.818ms      1000  66.817us  66.236us  71.708us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ4copyiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_NS3_IS7_JS8_NS_6DeviceINS_6SerialENS_9HostSpaceEEEEEESH_SH_SH_iEUliiiiE0_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSL_0EEEEEENS_4CudaEEEEEvT_
                    8.55%  62.129ms      1000  62.128us  61.628us  63.164us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ4copyiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_NS3_IS7_JS8_NS_6DeviceINS_6SerialENS_9HostSpaceEEEEEESH_SH_SH_iEUliiiiE3_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSL_0EEEEEENS_4CudaEEEEEvT_
                    0.08%  570.79us         5  114.16us  11.260us  525.69us  void Kokkos::Impl::cuda_parallel_launch_local_memory<Kokkos::Impl::ParallelFor<Kokkos::Impl::ViewValueFunctor<Kokkos::Cuda, double, bool=1>, Kokkos::RangePolicy<>, Kokkos::Cuda>>(Kokkos::Cuda)
                    0.00%  3.6720us         2  1.8360us  1.8200us  1.8520us  [CUDA memset]
                    0.00%  2.5240us         1  2.5240us  2.5240us  2.5240us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_threadid(int)
                    0.00%  2.2360us         1  2.2360us  2.2360us  2.2360us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_atomic(void)
                    0.00%  1.6920us         1  1.6920us  1.6920us  1.6920us  Kokkos::Impl::_GLOBAL__N__55_tmpxft_000196bf_00000000_7_Kokkos_Cuda_Instance_cpp1_ii_a8bc5097::query_cuda_kernel_arch(int*)
      API calls:   58.03%  953.98ms      4022  237.19us  23.530us  13.091ms  cudaMemcpy
                   39.03%  641.61ms      9003  71.266us  6.5930us  452.98ms  cudaDeviceSynchronize
                    1.84%  30.213ms      2008  15.046us  11.599us  38.932us  cudaLaunchKernel
                    0.36%  5.8646ms        11  533.14us  8.9270us  3.4191ms  cudaMalloc
                    0.22%  3.5792ms         4  894.81us  890.54us  902.58us  cuDeviceTotalMem
                    0.14%  2.3250ms         4  581.25us  534.38us  710.97us  cudaGetDeviceProperties
                    0.14%  2.2915ms       404  5.6710us     291ns  248.08us  cuDeviceGetAttribute
                    0.13%  2.1890ms        12  182.42us  2.8650us  607.92us  cudaFree
                    0.04%  604.86us         5  120.97us  18.025us  530.16us  cudaStreamSynchronize
                    0.03%  439.81us         1  439.81us  439.81us  439.81us  cudaHostAlloc
                    0.02%  400.01us         2  200.01us  18.292us  381.72us  cudaFreeHost
                    0.01%  207.04us         4  51.759us  50.285us  55.508us  cuDeviceGetName
                    0.00%  54.369us         2  27.184us  22.855us  31.514us  cudaMemset
                    0.00%  33.606us         2  16.803us  16.740us  16.866us  cudaMemcpyToSymbol
                    0.00%  13.425us         1  13.425us  13.425us  13.425us  cudaMallocHost
                    0.00%  9.9200us         5  1.9840us  1.8090us  2.5740us  cudaPointerGetAttributes
                    0.00%  8.3340us         4  2.0830us  1.2030us  3.4640us  cuDeviceGetPCIBusId
                    0.00%  7.0160us         3  2.3380us  2.0890us  2.6400us  cudaFuncSetCacheConfig
                    0.00%  6.5150us         1  6.5150us  6.5150us  6.5150us  cudaFuncGetAttributes
                    0.00%  5.7290us         1  5.7290us  5.7290us  5.7290us  cudaSetDevice
                    0.00%  3.6090us         1  3.6090us  3.6090us  3.6090us  cudaEventDestroy
                    0.00%  3.5800us         8     447ns     318ns     842ns  cuDeviceGet
                    0.00%  3.3860us         1  3.3860us  3.3860us  3.3860us  cudaEventCreate
                    0.00%  2.1840us         1  2.1840us  2.1840us  2.1840us  cudaDeviceSetCacheConfig
                    0.00%  1.6810us         4     420ns     375ns     481ns  cuDeviceGetUuid
                    0.00%  1.5510us         3     517ns     389ns     709ns  cuDeviceGetCount
                    0.00%  1.3650us         1  1.3650us  1.3650us  1.3650us  cudaGetLastError
                    0.00%  1.1410us         1  1.1410us  1.1410us  1.1410us  cudaGetDeviceCount

==143485== NVTX result:
==143485==   Thread "MPI Rank 1" (id = 317616)
==143485==     Domain "<unnamed>"
==143485==       Range "MPI_Recv"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  269.79ms      1000  269.79us  243.41us  18.880ms  MPI_Recv
No kernels were profiled in this range.
No API activities were profiled in this range.

==143485==       Range "MPI_Send"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  242.70ms      1000  242.70us  235.85us  600.49us  MPI_Send
No kernels were profiled in this range.
No API activities were profiled in this range.


==85856== NVTX result:
==85856==   Thread "MPI Rank 0" (id = 317616)
==85856==     Domain "<unnamed>"
==85856==       Range "MPI_Recv"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  242.87ms      1000  242.87us  233.74us  596.92us  MPI_Recv
No kernels were profiled in this range.
No API activities were profiled in this range.

==85856==       Range "MPI_Send"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  268.46ms      1000  268.46us  247.06us  5.9162ms  MPI_Send
No kernels were profiled in this range.
No API activities were profiled in this range.


# z direction
# direct

[haskins8@lassen101:build]$ lrun -M "-gpu" -N 2 -T 1 -g 1 --gpubind=off nvprof ./ping_pong 160 1000 4 0 2
==13893== NVPROF is profiling process 13893, command: ./ping_pong 160 1000 4 0 2
==155825== NVPROF is profiling process 155825, command: ./ping_pong 160 1000 4 0 2
=Duration  = 2775.952673
Latency   = 1.387976
Bandwidth = 2213294.217735
==155825== Profiling application: ./ping_pong 160 1000 4 0 2
==13893== Profiling application: ./ping_pong 160 1000 4 0 2
==13893== Profiling result:
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   56.57%  47.1754s  25600013  1.8420us  1.7910us  3.3280us  [CUDA memcpy DtoH]
                   43.43%  36.2226s  25600011  1.4140us  1.3120us  2.5600us  [CUDA memcpy HtoD]
                    0.00%  570.79us         5  114.16us  11.292us  525.63us  void Kokkos::Impl::cuda_parallel_launch_local_memory<Kokkos::Impl::ParallelFor<Kokkos::Impl::ViewValueFunctor<Kokkos::Cuda, double, bool=1>, Kokkos::RangePolicy<>, Kokkos::Cuda>>(Kokkos::Cuda)
                    0.00%  3.6400us         2  1.8200us  1.7880us  1.8520us  [CUDA memset]
                    0.00%  2.5560us         1  2.5560us  2.5560us  2.5560us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_threadid(int)
                    0.00%  2.1720us         1  2.1720us  2.1720us  2.1720us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_atomic(void)
                    0.00%  1.6600us         1  1.6600us  1.6600us  1.6600us  Kokkos::Impl::_GLOBAL__N__55_tmpxft_000196bf_00000000_7_Kokkos_Cuda_Instance_cpp1_ii_a8bc5097::query_cuda_kernel_arch(int*)
==155825== Profiling result:
      API calls:   86.74%  1.2e+03s  51200022  22.984us  20.624us  48.998ms  cudaMemcpy
                   13.25%  179.805s  25600003  7.0230us  6.6740us  330.62ms  cudaDeviceSynchronize
                    0.00%  5.8875ms        11  535.23us  8.8420us  3.4183ms  cudaMalloc
                    0.00%  3.5868ms         4  896.69us  891.62us  910.03us  cuDeviceTotalMem
                    0.00%  2.6465ms         4  661.62us  536.41us  1.0193ms  cudaGetDeviceProperties
                    0.00%  2.3143ms       404  5.7280us     297ns  253.00us  cuDeviceGetAttribute
                    0.00%  2.1844ms        12  182.03us  3.0030us  612.83us  cudaFree
                    0.00%  607.27us         5  121.45us  18.130us  531.00us  cudaStreamSynchronize
                    0.00%  483.78us         2  241.89us  18.535us  465.24us  cudaFreeHost
                    0.00%  443.29us         1  443.29us  443.29us  443.29us  cudaHostAlloc
                    0.00%  209.67us         4  52.416us  50.297us  57.016us  cuDeviceGetName
                    0.00%  130.09us         8  16.261us  12.374us  30.194us  cudaLaunchKernel
                    0.00%  54.227us         2  27.113us  22.197us  32.030us  cudaMemset
                    0.00%  33.969us         2  16.984us  16.918us  17.051us  cudaMemcpyToSymbol
                    0.00%  13.410us         1  13.410us  13.410us  13.410us  cudaMallocHost
                    0.00%  10.085us         5  2.0170us  1.7500us  2.7470us  cudaPointerGetAttributes
                    0.00%  8.7540us         4  2.1880us  1.2440us  3.6290us  cuDeviceGetPCIBusId
                    0.00%  6.4690us         1  6.4690us  6.4690us  6.4690us  cudaFuncGetAttributes
                    0.00%  6.1050us         1  6.1050us  6.1050us  6.1050us  cudaSetDevice
                    0.00%  3.6630us         8     457ns     353ns     728ns  cuDeviceGet
                    0.00%  3.6270us         1  3.6270us  3.6270us  3.6270us  cudaEventDestroy
                    0.00%  3.1010us         1  3.1010us  3.1010us  3.1010us  cudaEventCreate
                    0.00%  2.2410us         1  2.2410us  2.2410us  2.2410us  cudaDeviceSetCacheConfig
                    0.00%  2.0440us         1  2.0440us  2.0440us  2.0440us  cudaFuncSetCacheConfig
                    0.00%  1.6860us         4     421ns     397ns     463ns  cuDeviceGetUuid
                    0.00%  1.5780us         3     526ns     423ns     680ns  cuDeviceGetCount
                    0.00%  1.5410us         1  1.5410us  1.5410us  1.5410us  cudaGetLastError
                    0.00%  1.1150us         1  1.1150us  1.1150us  1.1150us  cudaGetDeviceCount
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   56.57%  47.1830s  25600013  1.8430us  1.7910us  3.2960us  [CUDA memcpy DtoH]
                   43.42%  36.2164s  25600011  1.4140us  1.3430us  2.5920us  [CUDA memcpy HtoD]
                    0.00%  570.54us         5  114.11us  11.260us  525.31us  void Kokkos::Impl::cuda_parallel_launch_local_memory<Kokkos::Impl::ParallelFor<Kokkos::Impl::ViewValueFunctor<Kokkos::Cuda, double, bool=1>, Kokkos::RangePolicy<>, Kokkos::Cuda>>(Kokkos::Cuda)
                    0.00%  3.6400us         2  1.8200us  1.7880us  1.8520us  [CUDA memset]
                    0.00%  2.4600us         1  2.4600us  2.4600us  2.4600us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_threadid(int)
                    0.00%  2.2680us         1  2.2680us  2.2680us  2.2680us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_atomic(void)
                    0.00%  1.5320us         1  1.5320us  1.5320us  1.5320us  Kokkos::Impl::_GLOBAL__N__55_tmpxft_000196bf_00000000_7_Kokkos_Cuda_Instance_cpp1_ii_a8bc5097::query_cuda_kernel_arch(int*)
      API calls:   86.73%  1.2e+03s  51200022  22.872us  20.694us  48.060ms  cudaMemcpy
                   13.27%  179.215s  25600003  7.0000us  6.6910us  355.25ms  cudaDeviceSynchronize
                    0.00%  5.8710ms        11  533.73us  8.5460us  3.4131ms  cudaMalloc
                    0.00%  3.5862ms         4  896.55us  891.59us  908.72us  cuDeviceTotalMem
                    0.00%  2.5951ms       404  6.4230us     294ns  534.76us  cuDeviceGetAttribute
                    0.00%  2.1975ms        12  183.13us  3.9980us  614.14us  cudaFree
                    0.00%  2.1400ms         4  535.00us  533.49us  538.33us  cudaGetDeviceProperties
                    0.00%  606.64us         5  121.33us  18.422us  530.64us  cudaStreamSynchronize
                    0.00%  423.77us         1  423.77us  423.77us  423.77us  cudaHostAlloc
                    0.00%  401.61us         2  200.80us  18.548us  383.06us  cudaFreeHost
                    0.00%  207.94us         4  51.985us  49.998us  56.701us  cuDeviceGetName
                    0.00%  131.04us         8  16.379us  12.228us  29.866us  cudaLaunchKernel
                    0.00%  53.285us         2  26.642us  22.763us  30.522us  cudaMemset
                    0.00%  34.175us         2  17.087us  16.675us  17.500us  cudaMemcpyToSymbol
                    0.00%  13.247us         1  13.247us  13.247us  13.247us  cudaMallocHost
                    0.00%  10.173us         5  2.0340us  1.6720us  2.8060us  cudaPointerGetAttributes
                    0.00%  9.1480us         4  2.2870us  1.2970us  3.8900us  cuDeviceGetPCIBusId
                    0.00%  7.2140us         1  7.2140us  7.2140us  7.2140us  cudaFuncGetAttributes
                    0.00%  5.5540us         1  5.5540us  5.5540us  5.5540us  cudaSetDevice
                    0.00%  3.6620us         8     457ns     314ns     719ns  cuDeviceGet
                    0.00%  3.4760us         1  3.4760us  3.4760us  3.4760us  cudaEventDestroy
                    0.00%  3.2770us         1  3.2770us  3.2770us  3.2770us  cudaEventCreate
                    0.00%  2.2720us         1  2.2720us  2.2720us  2.2720us  cudaDeviceSetCacheConfig
                    0.00%  2.1700us         1  2.1700us  2.1700us  2.1700us  cudaFuncSetCacheConfig
                    0.00%  1.7420us         4     435ns     393ns     506ns  cuDeviceGetUuid
                    0.00%  1.6710us         3     557ns     401ns     750ns  cuDeviceGetCount
                    0.00%  1.1170us         1  1.1170us  1.1170us  1.1170us  cudaGetLastError
                    0.00%     872ns         1     872ns     872ns     872ns  cudaGetDeviceCount

==13893== NVTX result:
==13893==   Thread "MPI Rank 0" (id = 317616)
==13893==     Domain "<unnamed>"
==13893==       Range "MPI_Recv"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  2.1e+03s      1000  2.14190s  2.12464s  2.22999s  MPI_Recv
 GPU activities:  100.00%  36.2225s  25600000  1.4140us  1.3120us  2.5600us  [CUDA memcpy HtoD]
      API calls:  100.00%  555.876s  25600000  21.713us  20.624us  8.0020ms  cudaMemcpy

==13893==       Range "MPI_Send"

==155825== NVTX result:
==155825==   Thread "MPI Rank 1" (id = 317616)
==155825==     Domain "<unnamed>"
==155825==       Range "MPI_Recv"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  634.044s      1000  634.04ms  622.77ms  688.95ms  MPI_Send
 GPU activities:  100.00%  47.1754s  25600000  1.8420us  1.7910us  3.3280us  [CUDA memcpy DtoH]
      API calls:  100.00%  620.932s  25600000  24.255us  23.025us  48.998ms  cudaMemcpy

            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  2.1e+03s      1000  2.14409s  1.42625s  2.27126s  MPI_Recv
 GPU activities:  100.00%  36.2163s  25600000  1.4140us  1.3430us  2.5920us  [CUDA memcpy HtoD]
      API calls:  100.00%  552.637s  25600000  21.587us  20.694us  48.060ms  cudaMemcpy

==155825==       Range "MPI_Send"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  631.104s      1000  631.10ms  625.09ms  650.04ms  MPI_Send
 GPU activities:  100.00%  47.1830s  25600000  1.8430us  1.7910us  3.2960us  [CUDA memcpy DtoH]
      API calls:  100.00%  618.416s  25600000  24.156us  23.279us  7.4569ms  cudaMemcpy

# z direction
# CUDA Aware
[haskins8@lassen163:build]$ lrun -M "-gpu" -N 2 -T 1 -g 1 --gpubind=off nvprof ./ping_pong 160 1000 4 1 2
==65743== NVPROF is profiling process 65743, command: ./ping_pong 160 1000 4 1 2
==128095== NVPROF is profiling process 128095, command: ./ping_pong 160 1000 4 1 2
Duration  = 0.927358
Latency   = 0.000464
Bandwidth = 6625272051.716330
==65743== Profiling application: ./ping_pong 160 1000 4 1 2
==128095== Profiling application: ./ping_pong 160 1000 4 1 2
==65743== Profiling result:
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   52.74%  65.062ms      1000  65.061us  64.155us  70.107us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ10cuda_awareiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_iEUliiiiE1_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSG_0EEEEEENS_4CudaEEEEEvT_
                   46.76%  57.692ms      1000  57.692us  57.244us  59.675us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ10cuda_awareiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_iEUliiiiE4_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSG_0EEEEEENS_4CudaEEEEEvT_
                    0.46%  564.01us         5  112.80us  11.132us  519.39us  void Kokkos::Impl::cuda_parallel_launch_local_memory<Kokkos::Impl::ParallelFor<Kokkos::Impl::ViewValueFunctor<Kokkos::Cuda, double, bool=1>, Kokkos::RangePolicy<>, Kokkos::Cuda>>(Kokkos::Cuda)
                    0.02%  26.112us        13  2.0080us  1.8240us  2.4000us  [CUDA memcpy DtoH]
                    0.01%  18.080us        11  1.6430us  1.4080us  1.8240us  [CUDA memcpy HtoD]
                    0.00%  3.7680us         2  1.8840us  1.8200us  1.9480us  [CUDA memset]
                    0.00%  2.5240us         1  2.5240us  2.5240us  2.5240us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_threadid(int)
                    0.00%  2.2040us         1  2.2040us  2.2040us  2.2040us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_atomic(void)
==128095== Profiling result:
                    0.00%  1.5320us         1  1.5320us  1.5320us  1.5320us  Kokkos::Impl::_GLOBAL__N__55_tmpxft_000196bf_00000000_7_Kokkos_Cuda_Instance_cpp1_ii_a8bc5097::query_cuda_kernel_arch(int*)
      API calls:   88.43%  474.00ms      2003  236.65us  9.0660us  339.74ms  cudaDeviceSynchronize
                    4.63%  24.843ms      2008  12.372us  11.477us  49.256us  cudaLaunchKernel
                    2.91%  15.621ms         5  3.1243ms  13.314us  3.9842ms  cudaMallocHost
                    1.41%  7.5685ms        12  630.71us  8.5720us  3.3907ms  cudaMalloc
                    0.67%  3.5877ms         4  896.92us  891.96us  911.05us  cuDeviceTotalMem
                    0.49%  2.6282ms        12  219.02us  17.105us  606.90us  cudaFree
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
                    0.43%  2.2943ms       404  5.6780us     295ns  249.33us  cuDeviceGetAttribute
                    0.41%  2.1708ms         4  542.71us  534.28us  551.88us  cudaGetDeviceProperties
                    0.12%  648.79us        22  29.490us  23.557us  50.988us  cudaMemcpy
                    0.11%  598.06us         5  119.61us  17.929us  523.85us  cudaStreamSynchronize
                    0.08%  443.04us         1  443.04us  443.04us  443.04us  cudaHostAlloc
 GPU activities:   52.22%  65.100ms      1000  65.100us  64.284us  69.916us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ10cuda_awareiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_iEUliiiiE1_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSG_0EEEEEENS_4CudaEEEEEvT_
                    0.08%  406.25us         2  203.12us  18.064us  388.18us  cudaFreeHost
                    0.07%  390.76us        32  12.211us  1.3730us  345.21us  cudaEventCreateWithFlags
                    0.04%  221.39us       129  1.7160us  1.4570us  6.5840us  cudaEventCreate
                    0.04%  209.19us         4  52.296us  50.596us  56.050us  cuDeviceGetName
                   47.28%  58.939ms      1000  58.938us  58.427us  60.444us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ10cuda_awareiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_iEUliiiiE4_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSG_0EEEEEENS_4CudaEEEEEvT_
                    0.01%  74.824us       241     310ns     258ns     883ns  cudaGetLastError
                    0.01%  55.908us         2  27.954us  23.960us  31.948us  cudaMemset
                    0.01%  49.280us        33  1.4930us  1.2580us  4.5880us  cudaEventDestroy
                    0.46%  570.63us         5  114.13us  11.227us  525.66us  void Kokkos::Impl::cuda_parallel_launch_local_memory<Kokkos::Impl::ParallelFor<Kokkos::Impl::ViewValueFunctor<Kokkos::Cuda, double, bool=1>, Kokkos::RangePolicy<>, Kokkos::Cuda>>(Kokkos::Cuda)
                    0.02%  26.144us        13  2.0110us  1.8240us  2.2400us  [CUDA memcpy DtoH]
                    0.01%  18.016us        11  1.6370us  1.3760us  1.8240us  [CUDA memcpy HtoD]
                    0.01%  37.404us         4  9.3510us  5.7500us  13.699us  cudaStreamCreateWithFlags
                    0.01%  35.587us        32  1.1120us     978ns  2.7840us  cudaIpcGetEventHandle
                    0.00%  3.6080us         2  1.8040us  1.7880us  1.8200us  [CUDA memset]
                    0.00%  2.4280us         1  2.4280us  2.4280us  2.4280us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_threadid(int)
                    0.01%  33.585us         2  16.792us  16.570us  17.015us  cudaMemcpyToSymbol
                    0.00%  2.2040us         1  2.2040us  2.2040us  2.2040us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_atomic(void)
                    0.00%  21.362us         1  21.362us  21.362us  21.362us  cudaStreamDestroy
                    0.00%  9.9370us         5  1.9870us  1.7830us  2.5610us  cudaPointerGetAttributes
                    0.00%  1.5960us         1  1.5960us  1.5960us  1.5960us  Kokkos::Impl::_GLOBAL__N__55_tmpxft_000196bf_00000000_7_Kokkos_Cuda_Instance_cpp1_ii_a8bc5097::query_cuda_kernel_arch(int*)
                    0.00%  8.4620us         3  2.8200us  2.0220us  3.7650us  cudaFuncSetCacheConfig
      API calls:   88.54%  487.38ms      2003  243.32us  9.1700us  352.25ms  cudaDeviceSynchronize
                    0.00%  8.3970us         4  2.0990us  1.2370us  3.5450us  cuDeviceGetPCIBusId
                    4.47%  24.601ms      2008  12.251us  11.385us  49.004us  cudaLaunchKernel
                    0.00%  6.8960us         1  6.8960us  6.8960us  6.8960us  cudaFuncGetAttributes
                    2.96%  16.289ms         5  3.2579ms  13.265us  4.1445ms  cudaMallocHost
                    1.38%  7.6081ms        12  634.01us  8.7230us  3.4235ms  cudaMalloc
                    0.00%  5.4890us         1  5.4890us  5.4890us  5.4890us  cudaSetDevice
                    0.65%  3.5869ms         4  896.72us  892.44us  908.98us  cuDeviceTotalMem
                    0.51%  2.8165ms       404  6.9710us     294ns  774.78us  cuDeviceGetAttribute
                    0.00%  3.5060us         8     438ns     361ns     682ns  cuDeviceGet
                    0.49%  2.6725ms        12  222.71us  16.767us  605.64us  cudaFree
                    0.41%  2.2436ms         4  560.89us  529.61us  649.53us  cudaGetDeviceProperties
                    0.00%  2.4390us         1  2.4390us  2.4390us  2.4390us  cudaDeviceSetCacheConfig
                    0.00%  1.6710us         4     417ns     368ns     460ns  cuDeviceGetUuid
                    0.12%  645.40us        22  29.336us  23.357us  48.010us  cudaMemcpy
                    0.11%  605.49us         5  121.10us  18.172us  530.53us  cudaStreamSynchronize
                    0.08%  447.17us         1  447.17us  447.17us  447.17us  cudaHostAlloc
                    0.00%  1.6570us         3     552ns     414ns     723ns  cuDeviceGetCount
                    0.07%  400.24us         2  200.12us  17.992us  382.24us  cudaFreeHost
                    0.00%  1.6110us         2     805ns     363ns  1.2480us  cudaGetDeviceCount
                    0.07%  381.85us        32  11.932us  1.3730us  336.42us  cudaEventCreateWithFlags
                    0.00%     627ns         1     627ns     627ns     627ns  cuCtxGetCurrent
                    0.04%  219.67us       129  1.7020us  1.4650us  6.6200us  cudaEventCreate
                    0.04%  210.59us         4  52.646us  50.653us  58.037us  cuDeviceGetName
                    0.00%     431ns         1     431ns     431ns     431ns  cuCtxGetDevice
                    0.01%  75.737us       241     314ns     253ns     902ns  cudaGetLastError
                    0.01%  53.406us         2  26.703us  22.251us  31.155us  cudaMemset
                    0.01%  48.982us        33  1.4840us  1.2600us  4.9600us  cudaEventDestroy
                    0.01%  38.396us         4  9.5990us  6.0600us  13.631us  cudaStreamCreateWithFlags
                    0.01%  35.678us        32  1.1140us  1.0110us  2.9250us  cudaIpcGetEventHandle
                    0.01%  33.692us         2  16.846us  16.466us  17.226us  cudaMemcpyToSymbol
                    0.00%  20.863us         1  20.863us  20.863us  20.863us  cudaStreamDestroy
                    0.00%  10.022us         5  2.0040us  1.7560us  2.7240us  cudaPointerGetAttributes
                    0.00%  9.0940us         4  2.2730us  1.2450us  3.5490us  cuDeviceGetPCIBusId
                    0.00%  8.4850us         3  2.8280us  2.0430us  3.7900us  cudaFuncSetCacheConfig
                    0.00%  6.6400us         1  6.6400us  6.6400us  6.6400us  cudaFuncGetAttributes
                    0.00%  5.7890us         1  5.7890us  5.7890us  5.7890us  cudaSetDevice
                    0.00%  3.7210us         8     465ns     361ns     758ns  cuDeviceGet
                    0.00%  2.0970us         1  2.0970us  2.0970us  2.0970us  cudaDeviceSetCacheConfig
                    0.00%  1.7110us         4     427ns     406ns     477ns  cuDeviceGetUuid
                    0.00%  1.5540us         2     777ns     372ns  1.1820us  cudaGetDeviceCount
                    0.00%  1.4960us         3     498ns     395ns     634ns  cuDeviceGetCount
                    0.00%     553ns         1     553ns     553ns     553ns  cuCtxGetCurrent
                    0.00%     420ns         1     420ns     420ns     420ns  cuCtxGetDevice

==65743== NVTX result:
==65743==   Thread "MPI Rank 1" (id = 317616)
==65743==     Domain "<unnamed>"
==65743==       Range "MPI_Recv"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  399.45ms      1000  399.45us  334.03us  49.411ms  MPI_Recv
No kernels were profiled in this range.
No API activities were profiled in this range.

==65743==       Range "MPI_Send"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  353.31ms      1000  353.31us  334.15us  13.411ms  MPI_Send
No kernels were profiled in this range.
No API activities were profiled in this range.


==128095== NVTX result:
==128095==   Thread "MPI Rank 0" (id = 317616)
==128095==     Domain "<unnamed>"
==128095==       Range "MPI_Recv"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  353.34ms      1000  353.34us  334.74us  13.432ms  MPI_Recv
No kernels were profiled in this range.
No API activities were profiled in this range.

==128095==       Range "MPI_Send"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  400.75ms      1000  400.75us  334.81us  51.370ms  MPI_Send
No kernels were profiled in this range.
No API activities were profiled in this range.

# z direction
# Copy
[haskins8@lassen421:build]$ lrun -M "-gpu" -N 2 -T 1 -g 1 --gpubind=off nvprof ./ping_pong 160 1000 4 2 2
==45567== NVPROF is profiling process 45567, command: ./ping_pong 160 1000 4 2 2
==24417== NVPROF is profiling process 24417, command: ./ping_pong 160 1000 4 2 2
Duration  = 1.703197
Latency   = 0.000852
Bandwidth = 3607334438.721827
==45567== Profiling application: ./ping_pong 160 1000 4 2 2
==24417== Profiling application: ./ping_pong 160 1000 4 2 2
==45567== Profiling result:
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   50.07%  357.63ms      2011  177.84us  1.3760us  237.31us  [CUDA memcpy HtoD]
                   33.11%  236.48ms      2013  117.48us  1.8240us  142.30us  [CUDA memcpy DtoH]
                    8.66%  61.872ms      1000  61.872us  61.148us  66.683us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ4copyiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_NS3_IS7_JS8_NS_6DeviceINS_6SerialENS_9HostSpaceEEEEEESH_SH_SH_iEUliiiiE1_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSL_0EEEEEENS_4CudaEEEEEvT_
==24417== Profiling result:
                    8.07%  57.646ms      1000  57.645us  57.020us  59.132us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ4copyiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_NS3_IS7_JS8_NS_6DeviceINS_6SerialENS_9HostSpaceEEEEEESH_SH_SH_iEUliiiiE4_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSL_0EEEEEENS_4CudaEEEEEvT_
                    0.08%  570.54us         5  114.11us  11.260us  525.30us  void Kokkos::Impl::cuda_parallel_launch_local_memory<Kokkos::Impl::ParallelFor<Kokkos::Impl::ViewValueFunctor<Kokkos::Cuda, double, bool=1>, Kokkos::RangePolicy<>, Kokkos::Cuda>>(Kokkos::Cuda)
                    0.00%  3.8000us         2  1.9000us  1.8200us  1.9800us  [CUDA memset]
                    0.00%  2.5240us         1  2.5240us  2.5240us  2.5240us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_threadid(int)
                    0.00%  2.3000us         1  2.3000us  2.3000us  2.3000us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_atomic(void)
                    0.00%  1.5320us         1  1.5320us  1.5320us  1.5320us  Kokkos::Impl::_GLOBAL__N__55_tmpxft_000196bf_00000000_7_Kokkos_Cuda_Instance_cpp1_ii_a8bc5097::query_cuda_kernel_arch(int*)
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   48.26%  352.15ms      2011  175.11us  1.4080us  241.18us  [CUDA memcpy HtoD]
                   34.75%  253.58ms      2013  125.97us  1.8240us  12.787ms  [CUDA memcpy DtoH]
      API calls:   63.17%  969.80ms      4022  241.12us  23.849us  368.96us  cudaMemcpy
                   33.79%  518.67ms      9003  57.610us  6.6040us  339.25ms  cudaDeviceSynchronize
                    1.87%  28.635ms      2008  14.260us  11.661us  35.708us  cudaLaunchKernel
                    0.38%  5.8575ms        11  532.50us  8.7540us  3.4176ms  cudaMalloc
                    0.23%  3.5799ms         4  894.99us  889.91us  905.24us  cuDeviceTotalMem
                    0.17%  2.5561ms       404  6.3260us     294ns  500.56us  cuDeviceGetAttribute
                    0.14%  2.1781ms        12  181.51us  2.9980us  606.15us  cudaFree
                    0.14%  2.1441ms         4  536.04us  532.86us  540.82us  cudaGetDeviceProperties
                    8.88%  64.784ms      1000  64.784us  63.932us  69.244us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ4copyiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_NS3_IS7_JS8_NS_6DeviceINS_6SerialENS_9HostSpaceEEEEEESH_SH_SH_iEUliiiiE1_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSL_0EEEEEENS_4CudaEEEEEvT_
                    0.04%  607.54us         5  121.51us  18.386us  530.20us  cudaStreamSynchronize
                    0.03%  420.53us         1  420.53us  420.53us  420.53us  cudaHostAlloc
                    0.02%  351.50us         2  175.75us  18.222us  333.27us  cudaFreeHost
                    0.01%  208.42us         4  52.106us  49.763us  57.480us  cuDeviceGetName
                    0.00%  54.071us         2  27.035us  22.639us  31.432us  cudaMemset
                    0.00%  33.617us         2  16.808us  16.534us  17.083us  cudaMemcpyToSymbol
                    0.00%  13.089us         1  13.089us  13.089us  13.089us  cudaMallocHost
                    0.00%  10.053us         5  2.0100us  1.7990us  2.6130us  cudaPointerGetAttributes
                    8.02%  58.532ms      1000  58.531us  57.915us  59.580us  _ZN6Kokkos4Impl33cuda_parallel_launch_local_memoryINS0_11ParallelForIZ4copyiiNS_4ViewIPPPPdJNS_11LayoutRightEEEE11inputConfigiiS9_S9_S9_S9_P15ompi_datatype_tSC_SC_SC_NS3_IS7_JS8_NS_6DeviceINS_6SerialENS_9HostSpaceEEEEEESH_SH_SH_iEUliiiiE4_NS_13MDRangePolicyIJNS_4RankILj4ELNS_7IterateE0ELSL_0EEEEEENS_4CudaEEEEEvT_
                    0.00%  9.4590us         4  2.3640us  1.2850us  3.6230us  cuDeviceGetPCIBusId
                    0.00%  7.4950us         3  2.4980us  2.1320us  2.8590us  cudaFuncSetCacheConfig
                    0.00%  6.8490us         1  6.8490us  6.8490us  6.8490us  cudaFuncGetAttributes
                    0.00%  5.7730us         1  5.7730us  5.7730us  5.7730us  cudaSetDevice
                    0.08%  570.73us         5  114.15us  11.260us  525.47us  void Kokkos::Impl::cuda_parallel_launch_local_memory<Kokkos::Impl::ParallelFor<Kokkos::Impl::ViewValueFunctor<Kokkos::Cuda, double, bool=1>, Kokkos::RangePolicy<>, Kokkos::Cuda>>(Kokkos::Cuda)
                    0.00%  3.6980us         8     462ns     367ns     649ns  cuDeviceGet
                    0.00%  3.4360us         1  3.4360us  3.4360us  3.4360us  cudaEventDestroy
                    0.00%  3.6070us         2  1.8030us  1.7550us  1.8520us  [CUDA memset]
                    0.00%  3.2320us         1  3.2320us  3.2320us  3.2320us  cudaEventCreate
                    0.00%  2.1970us         1  2.1970us  2.1970us  2.1970us  cudaDeviceSetCacheConfig
                    0.00%  2.4920us         1  2.4920us  2.4920us  2.4920us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_threadid(int)
                    0.00%  2.2040us         1  2.2040us  2.2040us  2.2040us  Kokkos::_GLOBAL__N__52_tmpxft_0001969b_00000000_7_Kokkos_Cuda_Locks_cpp1_ii_915ea793::init_lock_array_kernel_atomic(void)
                    0.00%  1.6090us         4     402ns     376ns     440ns  cuDeviceGetUuid
                    0.00%  1.4920us         3     497ns     389ns     627ns  cuDeviceGetCount
                    0.00%  1.5320us         1  1.5320us  1.5320us  1.5320us  Kokkos::Impl::_GLOBAL__N__55_tmpxft_000196bf_00000000_7_Kokkos_Cuda_Instance_cpp1_ii_a8bc5097::query_cuda_kernel_arch(int*)
                    0.00%  1.4100us         1  1.4100us  1.4100us  1.4100us  cudaGetLastError
                    0.00%  1.2260us         1  1.2260us  1.2260us  1.2260us  cudaGetDeviceCount
      API calls:   63.34%  968.76ms      4022  240.86us  23.210us  12.932ms  cudaMemcpy
                   33.45%  511.64ms      9003  56.829us  6.6170us  328.51ms  cudaDeviceSynchronize
                    1.98%  30.288ms      2008  15.083us  11.748us  33.674us  cudaLaunchKernel
                    0.38%  5.8575ms        11  532.50us  8.5480us  3.4162ms  cudaMalloc
                    0.23%  3.5871ms         4  896.78us  892.55us  908.24us  cuDeviceTotalMem
                    0.20%  3.0686ms         4  767.15us  532.79us  1.4626ms  cudaGetDeviceProperties
                    0.15%  2.2921ms       404  5.6730us     295ns  252.12us  cuDeviceGetAttribute
                    0.14%  2.2055ms        12  183.80us  3.9380us  606.39us  cudaFree
                    0.04%  607.00us         5  121.40us  18.338us  531.01us  cudaStreamSynchronize
                    0.03%  429.51us         1  429.51us  429.51us  429.51us  cudaHostAlloc
                    0.03%  391.80us         2  195.90us  18.109us  373.69us  cudaFreeHost
                    0.01%  213.23us         4  53.307us  49.796us  56.418us  cuDeviceGetName
                    0.00%  53.350us         2  26.675us  21.940us  31.410us  cudaMemset
                    0.00%  33.682us         2  16.841us  16.173us  17.509us  cudaMemcpyToSymbol
                    0.00%  12.946us         1  12.946us  12.946us  12.946us  cudaMallocHost
                    0.00%  9.9630us         5  1.9920us  1.7950us  2.3170us  cudaPointerGetAttributes
                    0.00%  8.5130us         4  2.1280us  1.2460us  3.4780us  cuDeviceGetPCIBusId
                    0.00%  7.0490us         3  2.3490us  2.1430us  2.6110us  cudaFuncSetCacheConfig
                    0.00%  6.5060us         1  6.5060us  6.5060us  6.5060us  cudaFuncGetAttributes
                    0.00%  6.0860us         1  6.0860us  6.0860us  6.0860us  cudaSetDevice
                    0.00%  3.7030us         8     462ns     353ns     682ns  cuDeviceGet
                    0.00%  3.6640us         1  3.6640us  3.6640us  3.6640us  cudaEventDestroy
                    0.00%  3.2930us         1  3.2930us  3.2930us  3.2930us  cudaEventCreate
                    0.00%  2.4840us         1  2.4840us  2.4840us  2.4840us  cudaDeviceSetCacheConfig
                    0.00%  1.8060us         1  1.8060us  1.8060us  1.8060us  cudaGetLastError
                    0.00%  1.6520us         4     413ns     379ns     477ns  cuDeviceGetUuid
                    0.00%  1.6230us         3     541ns     437ns     725ns  cuDeviceGetCount
                    0.00%  1.2030us         1  1.2030us  1.2030us  1.2030us  cudaGetDeviceCount

==45567== NVTX result:
==45567==   Thread "MPI Rank 0" (id = 317616)
==45567==     Domain "<unnamed>"
==45567==       Range "MPI_Recv"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  247.52ms      1000  247.52us  231.15us  12.614ms  MPI_Recv
No kernels were profiled in this range.
No API activities were profiled in this range.

==45567==       Range "MPI_Send"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  252.34ms      1000  252.34us  236.83us  13.026ms  MPI_Send
No kernels were profiled in this range.
No API activities were profiled in this range.


==24417== NVTX result:
==24417==   Thread "MPI Rank 1" (id = 317616)
==24417==     Domain "<unnamed>"
==24417==       Range "MPI_Recv"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  247.85ms      1000  247.85us  233.79us  2.3912ms  MPI_Recv
No kernels were profiled in this range.
No API activities were profiled in this range.

==24417==       Range "MPI_Send"
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
          Range:  100.00%  248.43ms      1000  248.43us  232.59us  12.594ms  MPI_Send
No kernels were profiled in this range.
No API activities were profiled in this range.
